# -*- coding: utf-8 -*-

<%namespace name="messages_and_text" file="/dagr/components/messagesAndText.html"/>

<legend>Relations</legend>
<div style="margin-bottom:35px">
  <table class="table table-striped table-bordered table-hover table-condensed" id="relationsDetailsTable${event.identifier}">
    <thead>
      <tr>
      <th caria-controls="relationsDetailsTable" tabindex="0" role="columnheader" class="sorting">#</th>
      <th caria-controls="relationsDetailsTable" tabindex="1" role="columnheader" class="sorting">Attribute type</th>
      <th caria-controls="relationsDetailsTable" tabindex="2" role="columnheader" class="sorting">Attribute value</th>
      <th caria-controls="relationsDetailsTable" tabindex="5" role="columnheader" class="sorting">Attribute #</th>
      <th caria-controls="relationsDetailsTable" tabindex="6" role="columnheader" class="sorting">Event #</th>
      <th caria-controls="relationsDetailsTable" tabindex="7" role="columnheader" class="sorting">Event Title</th>
      <th caria-controls="relationsDetailsTable" tabindex="8" role="columnheader" class="sorting">Options</th>
      </tr>
    </thead>
    <tbody>
    <%
    counter = 0
    %>
    %for key in relations.get_keys():
      <%
      (type, value) = relations.get_type_value(key)
      first = True
      key_relations = relations.get_relations_by_key(key)
      array_length=len(key_relations)
      counter=counter+1
      %>
      <tr>
      <td rowspan="${array_length}">${counter}</td>
      <td rowspan="${array_length}"><%call expr="messages_and_text.object_to_html(type, shorten_to=100,use_plain_text=False)"/></td>
      <td rowspan="${array_length}"><%call expr="messages_and_text.object_to_html(value, shorten_to=100,use_plain_text=False)"/></td>
      
	    %for relation in key_relations:
	      <%
	      if relation.rel_event.published == 0:
	        style = 'background-color: #ff0000; cursor: pointer;'
	      else:
	        style = 'cursor: pointer;'
	      %>
        %if first:
          <%
          first = False
          %>
        %else:
          <tr>
        %endif
	      <td><%call expr="messages_and_text.object_to_html(relation.rel_attribute.identifier, shorten_to=100,use_plain_text=False)"/></td>
	      <%
	      if relation.rel_event.bit_value.is_validated:
	        url_ = url
	      else:
	        url_ = validation_url
	      %>
	      <td style="${style}" onclick="loadNewSideNavTab('${relation.rel_event.identifier}', '${tab_id}', '${url_}/${relation.rel_event.identifier}', false, '${messages_and_text.b64(text=u'Event #{0} - {1}'.format(relation.rel_event.identifier, relation.rel_event.title))}');"><%call expr="messages_and_text.object_to_html(relation.rel_event.identifier, shorten_to=100,use_plain_text=False)"/></td>
	      <td><%call expr="messages_and_text.object_to_html(relation.rel_event.title, shorten_to=100,use_plain_text=False)"/></td>
	      
	      <td style="width: 60px;">
	        <a href="#" onclick="loadNewSideNavTab('${relation.rel_event.identifier}', '${tab_id}', '${url_}/${relation.rel_event.identifier}', false, '${messages_and_text.b64(text=u'Event #{0} - {1}'.format(relation.rel_event.identifier, relation.rel_event.title))}');">
	           <span class="glyphicon glyphicon-eye-open" title="View event"></span>
	        </a>
	      </td>
	      </tr>
	    %endfor
    %endfor
    </tbody>
  </table>
</div>
