# -*- coding: utf-8 -*-

<%namespace name="modals" file="/dagr/components/modals.html"/>
<%namespace name="baseForms" file="/dagr/components/forms.html"/> 
<%namespace name="forms" file="/ce1sus/components/forms.html"/> 
<%namespace name="pagination" file="/dagr/components/pagination.html"/>



<div id="deleteAnswer" style="display: none;">
</div>
<script type="text/javascript">
function deleteObject(eventID, objectID){
    $("#deleteAnswer").load("/events/event/objects/removeObject?eventID="+eventID+"&objectID="+objectID, "", 
               function (responseText, textStatus, XMLHttpRequest) {
                  if(textStatus == 'error') {
                      alert('Delete Failed:'+responseText);
                  }
                  if (responseText.match(/^--OK--/gi)) {
                      //close tab!
                      loadContent('eventsTabTabContent','/events/event/objects/objects/'+eventID);
                  } else {
                      alert('Delete Failed:'+responseText);
                  }
            });
}
</script>
<h2>Object Details</h2>
<%call expr="forms.eventObjectForm(eventID,object, False,cbObjDefinitions)"/>
<div class="row-fluid">
    <div class="span3" style="text-align:right">
        <div class="btn-group">
          %if not object is None:
          <button class="btn btn-danger" 
            onclick="if (confirm('Are you sure you want to delete?')) {deleteObject(${eventID},${object.identifier})}">Delete</button>
          %endif
        </div>
    </div>
</div>
<legend>Referenced by</legend>
%if not object is None:
    %for refObject in object.objects:
        Object<br/>
    %endfor
%endif
<br/>
<legend>Attributes</legend>
<%
if not object is None: 
    paginator.list = object.attributes
    objID = object.identifier
else:
    paginator.list = list()
    objID = ''
%>
<%call expr="pagination.pagination('attributesTable'+unicode(objID),paginator,hasSearch=False)"/>
<div class="btn-group">
    %if not object is None:
        <a href="#addAbjectAttributeModal" role="button" class="btn" data-toggle="modal">Add an Attribute</a>
    %endif
</div>
<br/>

<%call expr="baseForms.genericModalForm(modalID='addAbjectAttributeModal',url='/events/event/attribute/modifyAttribute',refreshUrl='/events/event/objects/objects/{0}'.format(eventID),refreshContainer='eventTabs{0}TabContent'.format(eventID))">
<input type="hidden" name="action" value="insert">
<%call expr="modals.saveButtonModal(id='addAbjectAttributeModal',title='Add attribute',contentUrl='/events/event/attribute/addAttribute/{0}/{1}'.format(eventID, objID))"/>
</%call>

