<%namespace name="messages_and_text" file="/dagr/components/messagesAndText.html"/>

<%
#sort results
events = list()
others = list()

for result in results:
  if result.__class__.__name__ == 'Event':
    events.append(result)
  else:
    others.append(result)
%>
%if events:
<h3>Found ${len(events)} matches in Events </h3>
<div style="margin-bottom:35px">
  <table class="table table-striped table-bordered table-hover table-condensed" id="searchEventsTable">
  <thead>
    <tr>
    <th caria-controls="searchEventsTable" tabindex="0" role="columnheader" class="sorting">#</th>
    <th caria-controls="searchEventsTable" tabindex="1" role="columnheader" class="sorting">Title</th>
    <th caria-controls="searchEventsTable" tabindex="2" role="columnheader" class="sorting">Analysis</th>
    <th caria-controls="searchEventsTable" tabindex="3" role="columnheader" class="sorting">Risk</th>
    <th caria-controls="searchEventsTable" tabindex="4" role="columnheader" class="sorting">Status</th>
    <th caria-controls="searchEventsTable" tabindex="5" role="columnheader" class="sorting">TLP</th>
    <th caria-controls="searchEventsTable" tabindex="6" role="columnheader" class="sorting">Creator group</th>
    <th caria-controls="searchEventsTable" tabindex="7" role="columnheader" class="sorting">Creation date</th>
    <th caria-controls="searchEventsTable" tabindex="8" role="columnheader" class="sorting">Options</th>
    </tr>
  </thead>
  <tbody>
  %for event in events:
    <%
    if event.published == 0:
      style = 'background-color: #ff0000;'
    else:
      style = ''
    %>
    <tr>
      <td style="${style} cursor: pointer;" onclick="loadNewSideNavTab('${event.identifier}', '${tab_id}', '${url}/${event.identifier}', false, '${messages_and_text.b64(text=u'Event #{0} - {1}'.format(event.identifier, event.title))}');"><%call expr="messages_and_text.object_to_html(event.identifier, shorten_to=100,use_plain_text=False)"/></td>
      <td><%call expr="messages_and_text.object_to_html(event.title, shorten_to=100,use_plain_text=False)"/></td>
      <td><%call expr="messages_and_text.object_to_html(event.analysis, shorten_to=100,use_plain_text=False)"/></td>
      <td><%call expr="messages_and_text.object_to_html(event.risk, shorten_to=100,use_plain_text=False)"/></td>
      <td><%call expr="messages_and_text.object_to_html(event.status, shorten_to=100,use_plain_text=False)"/></td>
      <td style="background-color: ${event.tlp.color}"><%call expr="messages_and_text.object_to_html(event.tlp.text, shorten_to=100,use_plain_text=False)"/></td>
      <td><%call expr="messages_and_text.object_to_html(event.creator_group.name, shorten_to=100,use_plain_text=False)"/></td>
      <td><%call expr="messages_and_text.object_to_html(event.created, shorten_to=100,use_plain_text=False)"/></td>
      <td style="width: 60px;">
        <a href="#" onclick="loadNewSideNavTab('${event.identifier}', '${tab_id}', '${url}/${event.identifier}', true, '${messages_and_text.b64(text=u'Event #{0} - {1}'.format(event.identifier, event.title))}');">
           <span class="glyphicon glyphicon-eye-open" title="View event"></span>
        </a>
      </td>
    </tr>
  %endfor
  </tbody>
  </table>
</div>

<script type="text/javascript">
  jQuery.fn.dataTableExt.oSort['string-case-asc']  = function(x,y) {
    return ((x < y) ? -1 : ((x > y) ?  1 : 0));
  };
   
  jQuery.fn.dataTableExt.oSort['string-case-desc'] = function(x,y) {
    return ((x < y) ?  1 : ((x > y) ? -1 : 0));
  };
  
  $(document).ready(function() {
    $('#searchEventsTable').dataTable( {
      "iDisplayLength": 10,
      "aaSorting": [[ 0, "desc" ]],
    });
  });
</script>
%else:
<h3>Found 0 matches in Events </h3>
%endif
%if others:
<h3>Found ${len(others)} in Attributes</h3>
<div style="margin-bottom:30px;margin-top:30px">
  <table class="table table-striped table-bordered table-hover table-condensed" id="rearchResultsTable">
  <thead>
    <tr>
    <th caria-controls="rearchResultsTable" tabindex="0" role="columnheader" class="sorting">#</th>
    <th caria-controls="rearchResultsTable" tabindex="1" role="columnheader" class="sorting">Event #</th>
    <th caria-controls="rearchResultsTable" tabindex="2" role="columnheader" class="sorting">Event Name</th>
    <th caria-controls="rearchResultsTable" tabindex="3" role="columnheader" class="sorting">Object Type</th>
    <th caria-controls="rearchResultsTable" tabindex="4" role="columnheader" class="sorting">Attribute Type</th>
    <th caria-controls="rearchResultsTable" tabindex="5" role="columnheader" class="sorting">Attribute Value</th>
    <th caria-controls="rearchResultsTable" tabindex="6" role="columnheader" class="sorting">Options</th>
    </tr>
  </thead>
  <tbody>
  <% counter=0%>
  %for result in others:
    <%
    if result.event.published == 0:
      style = 'background-color: #ff0000'
    else:
      style = ''
    counter = counter +1
    %>
    <tr>
    <td style="cursor: pointer;" onclick="loadNewSideNavTab('${result.event.identifier}', 'eventsTabTabContent', '/events/event/view/${result.event.identifier}', true, 'Event #${result.event.identifier}');"><%call expr="messages_and_text.object_to_html(counter, shorten_to=100,use_plain_text=False)"/></td>
    <td ${style}><%call expr="messages_and_text.object_to_html(result.event.identifier, shorten_to=100,use_plain_text=False)"/></td>
    <td><%call expr="messages_and_text.object_to_html(result.event.title, shorten_to=100,use_plain_text=False)"/></td>
    <td><%call expr="messages_and_text.object_to_html(result.attribute.object.definition.name, shorten_to=100,use_plain_text=False)"/></td>
    <td><%call expr="messages_and_text.object_to_html(result.attribute.definition.name, shorten_to=100,use_plain_text=False)"/></td>
    <td><%call expr="messages_and_text.object_to_html(result.attribute.gui_value, shorten_to=100,use_plain_text=False)"/></td>
    
    
    <td style="width: 60px;">
      <a href="#" onclick="loadNewSideNavTab('${result.event.identifier}', 'eventsTabTabContent', '/events/event/view/${result.event.identifier}', true, 'Event #${result.event.identifier}');">
         <span class="glyphicon glyphicon-eye-open" title="View event"></span>
      </a>
    </td>
    </tr>
  %endfor
  </tbody>
  </table>
</div>

<script type="text/javascript">
jQuery.fn.dataTableExt.oSort['string-case-asc']  = function(x,y) {
  return ((x < y) ? -1 : ((x > y) ?  1 : 0));
};
 
jQuery.fn.dataTableExt.oSort['string-case-desc'] = function(x,y) {
  return ((x < y) ?  1 : ((x > y) ? -1 : 0));
};
$(document).ready(function() {
  $('#rearchResultsTable').dataTable( {
    "iDisplayLength": 10,
    "aaSorting": [[ 0, "asc" ]],
  });
});
</script>
%else:
<h3>Found 0 in Attributes</h3>
%endif
